<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>300PB 自动驾驶数据挖掘 - 下一代架构演示系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --primary: #3b82f6;
            --accent: #10b981;
            --danger: #ef4444;
            --text-main: #f1f5f9;
            --text-sub: #94a3b8;
            --code-bg: #0f1117;
        }

        * { box-sizing: border-box; transition: all 0.3s ease; }

        body {
            margin: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            overflow-x: hidden;
        }

        /* --- 1. Hero 区域 (视频级 Canvas 背景) --- */
        #hero-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: 0;
            opacity: 0.6;
        }

        .hero-section {
            position: relative;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 1;
            background: radial-gradient(circle at center, transparent 0%, var(--bg-dark) 100%);
        }

        .hero-title {
            font-size: 4rem;
            font-weight: 800;
            background: linear-gradient(to right, #60a5fa, #34d399);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            animation: slideUp 1s ease-out;
        }

        .hero-subtitle {
            font-size: 1.5rem;
            color: var(--text-sub);
            max-width: 800px;
            margin-bottom: 40px;
            line-height: 1.6;
        }

        .btn-start {
            padding: 15px 40px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        .btn-start:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.8);
        }

        /* --- 2. 交互式架构演示 (Grid 布局) --- */
        .section {
            padding: 80px 10%;
            min-height: 80vh;
            border-bottom: 1px solid #334155;
        }

        .split-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            align-items: center;
        }

        .text-content h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .text-content p {
            font-size: 1.1rem;
            color: var(--text-sub);
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .visual-box {
            background: var(--bg-card);
            border-radius: 20px;
            height: 400px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            border: 1px solid #334155;
        }

        /* --- 架构模拟动画 --- */
        .node {
            position: absolute;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: white;
            box-shadow: 0 0 15px currentColor;
        }

        .master-node { width: 80px; height: 80px; background: var(--danger); top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10; }
        .worker-node { width: 50px; height: 50px; background: var(--accent); transition: all 1s; }
        .client-dot {
            width: 8px; height: 8px; background: white; position: absolute; border-radius: 50%; opacity: 0;
        }

        /* --- 3. 代码 IDE 仿真区 --- */
        .ide-container {
            background: var(--code-bg);
            border-radius: 15px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 1px solid #334155;
        }

        .ide-header {
            background: #0f172a;
            padding: 15px;
            display: flex;
            gap: 15px;
            border-bottom: 1px solid #334155;
        }

        .tab {
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            color: var(--text-sub);
            font-size: 0.9rem;
        }

        .tab.active { background: #1e293b; color: white; border-left: 3px solid var(--primary); }

        .ide-body {
            display: flex;
            height: 400px;
        }

        .editor {
            flex: 1;
            padding: 20px;
            font-family: 'Consolas', monospace;
            color: #d4d4d4;
            font-size: 14px;
            line-height: 1.6;
            border-right: 1px solid #334155;
            position: relative;
        }

        .monitor {
            flex: 1;
            padding: 20px;
            background: #1e293b;
            display: flex;
            flex-direction: column;
        }

        .latency-bar-container {
            margin-top: 20px;
        }

        .latency-bar {
            height: 20px;
            background: #334155;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 5px;
            position: relative;
        }

        .latency-fill {
            height: 100%;
            width: 0%;
            transition: width 0.1s linear;
        }

        .btn-run {
            margin-top: auto;
            padding: 10px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-run:disabled { background: #64748b; cursor: not-allowed; }

        /* 语法高亮 */
        .kwd { color: #569cd6; } /* keyword */
        .str { color: #ce9178; } /* string */
        .fn { color: #dcdcaa; } /* function */
        .com { color: #6a9955; } /* comment */

        /* 动画 */
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }

        /* 响应式 */
        @media (max-width: 768px) {
            .split-layout { grid-template-columns: 1fr; }
            .hero-title { font-size: 2.5rem; }
        }
    </style>
</head>
<body>

    <canvas id="hero-canvas"></canvas>

    <div class="hero-section">
        <h1 class="hero-title">300PB 数据的极限挑战</h1>
        <p class="hero-subtitle">
            从 <strong>拥堵的 JFS 集中式架构</strong> 到 <strong>Alluxio DORA 去中心化架构</strong>。<br>
            专为自动驾驶 MCAP 高并发挖掘场景设计。
        </p>
        <button class="btn-start" onclick="document.getElementById('demo-part-1').scrollIntoView({behavior: 'smooth'})">
            <i class="fas fa-play-circle"></i> 开始交互体验
        </button>
    </div>

    <div id="demo-part-1" class="section">
        <div class="split-layout">
            <div class="text-content">
                <h2 style="color: var(--danger)"><i class="fas fa-exclamation-triangle"></i> 瓶颈现状：JFS 集中式架构</h2>
                <p>
                    <strong>场景：</strong> 10 万个并发任务同时向“元数据 Master”发起请求。<br>
                    <strong>结果：</strong> <span style="color:var(--danger)">系统雪崩。</span>
                </p>
                <p>
                    这就像 10 万个人同时挤进一个超市的单一收银台。Master 节点成为绝对瓶颈，CPU 负载 100%，请求排队超时。
                </p>
                <div style="background: rgba(239, 68, 68, 0.1); padding: 15px; border-left: 4px solid var(--danger); border-radius: 4px;">
                    <i class="fas fa-bug"></i> <strong>演示说明：</strong> 右侧模拟了 500 个请求同时攻击单一 Master 节点的场景。红色代表阻塞。
                </div>
            </div>
            <div class="visual-box" id="visual-jfs">
                <div class="master-node">Master</div>
                <div style="position: absolute; bottom: 10px; width: 100%; text-align: center; color: var(--danger); font-weight: bold;">
                    阻塞率: <span id="block-rate">0%</span> (模拟中...)
                </div>
            </div>
        </div>
    </div>

    <div class="section">
        <div class="split-layout">
            <div class="visual-box" id="visual-alluxio">
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 200px; height: 200px; border: 2px dashed #334155; border-radius: 50%;"></div>
                <div style="position: absolute; bottom: 10px; width: 100%; text-align: center; color: var(--accent); font-weight: bold;">
                    吞吐量: <span id="tps-rate">0</span> MB/s (线性增长)
                </div>
            </div>
            <div class="text-content">
                <h2 style="color: var(--accent)"><i class="fas fa-project-diagram"></i> 架构升级：Alluxio DORA</h2>
                <p>
                    <strong>核心原理：</strong> 一致性哈希 (Consistent Hashing)。<br>
                    <strong>效果：</strong> <span style="color:var(--accent)">线性扩展，永不拥堵。</span>
                </p>
                <p>
                    不再有“总管”。文件元数据被均匀打散到所有 Worker 节点。客户端通过计算 Hash 值，直接找到对应的 Worker。
                </p>
                <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-left: 4px solid var(--accent); border-radius: 4px;">
                    <i class="fas fa-check-circle"></i> <strong>演示说明：</strong> 左侧展示了 DORA 架构。请求被均匀分发到环上的 6 个 Worker 节点，毫无阻塞。
                </div>
            </div>
        </div>
    </div>

    <div class="section" style="background: #111827;">
        <div style="text-align: center; margin-bottom: 40px;">
            <h2><i class="fas fa-code"></i> 开发者体验对比实验室</h2>
            <p style="color: var(--text-sub)">点击运行，亲身体验 FUSE 挂载模式与 SDK 直连模式的性能差异</p>
        </div>

        <div class="ide-container">
            <div class="ide-header">
                <div class="tab active" onclick="switchTab('jfs')" id="tab-jfs">Legacy: JFS (FUSE)</div>
                <div class="tab" onclick="switchTab('alluxio')" id="tab-alluxio">Next-Gen: Alluxio SDK</div>
            </div>
            
            <div class="ide-body">
                <div class="editor" id="code-content">
                    </div>

                <div class="monitor">
                    <h3 style="margin-top: 0; color: white;">性能监控面板</h3>
                    
                    <div class="latency-bar-container">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-sub);">
                            <span>IO Latency (延时)</span>
                            <span id="latency-val">0ms</span>
                        </div>
                        <div class="latency-bar">
                            <div class="latency-fill" id="bar-latency"></div>
                        </div>
                    </div>

                    <div class="latency-bar-container">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-sub);">
                            <span>CPU Context Switch (消耗)</span>
                            <span id="cpu-val">0%</span>
                        </div>
                        <div class="latency-bar">
                            <div class="latency-fill" id="bar-cpu"></div>
                        </div>
                    </div>

                    <div style="margin-top: 20px; font-family: monospace; font-size: 0.8rem; height: 100px; overflow-y: auto; color: #64748b;" id="console-log">
                        > Ready to run...
                    </div>

                    <button class="btn-run" onclick="runCode()" id="btn-run-code">
                        <i class="fas fa-play"></i> 运行代码仿真
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* ================== 1. Hero Canvas 粒子背景 (模拟数据流视频) ================== */
        const canvas = document.getElementById('hero-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        class Particle {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = Math.random() * 2 + 1;
                this.speedX = Math.random() * 3 + 1; // 向右流动
                this.speedY = (Math.random() - 0.5) * 0.5;
                this.color = `rgba(59, 130, 246, ${Math.random() * 0.5})`; // 蓝色基调
            }
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                if (this.x > canvas.width) this.x = 0;
                if (this.y > canvas.height || this.y < 0) this.y = Math.random() * canvas.height;
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function initParticles() {
            particles = [];
            for (let i = 0; i < 150; i++) {
                particles.push(new Particle());
            }
        }

        function animateParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // 绘制网格线增强科技感
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
            ctx.beginPath();
            for(let i=0; i<canvas.width; i+=50) { ctx.moveTo(i,0); ctx.lineTo(i, canvas.height); }
            for(let i=0; i<canvas.height; i+=50) { ctx.moveTo(0,i); ctx.lineTo(canvas.width, i); }
            ctx.stroke();

            particles.forEach(p => {
                p.update();
                p.draw();
            });
            requestAnimationFrame(animateParticles);
        }
        initParticles();
        animateParticles();


        /* ================== 2. 架构模拟动画 (Architecture Simulator) ================== */
        // JFS 模拟: 所有点汇聚到中心
        function startJFSSimulation() {
            const container = document.getElementById('visual-jfs');
            const master = container.querySelector('.master-node');
            const rateSpan = document.getElementById('block-rate');
            
            setInterval(() => {
                const dot = document.createElement('div');
                dot.className = 'client-dot';
                // 随机从四周生成
                const side = Math.floor(Math.random() * 4);
                if (side===0) { dot.style.top = '0px'; dot.style.left = Math.random()*100 + '%'; }
                if (side===1) { dot.style.bottom = '0px'; dot.style.left = Math.random()*100 + '%'; }
                if (side===2) { dot.style.left = '0px'; dot.style.top = Math.random()*100 + '%'; }
                if (side===3) { dot.style.right = '0px'; dot.style.top = Math.random()*100 + '%'; }
                
                container.appendChild(dot);

                // 动画: 移动到中心
                const centerX = container.offsetWidth / 2;
                const centerY = container.offsetHeight / 2;
                
                // 使用 Web Animation API
                const anim = dot.animate([
                    { opacity: 1 },
                    { transform: `translate(${centerX - dot.offsetLeft}px, ${centerY - dot.offsetTop}px)` }
                ], {
                    duration: 1500,
                    easing: 'ease-in'
                });

                anim.onfinish = () => {
                    dot.remove();
                    // 模拟阻塞率跳动
                    let rate = parseInt(rateSpan.innerText);
                    if(Math.random() > 0.3) rate += 5; 
                    if(rate > 99) rate = 80;
                    rateSpan.innerText = rate + '%';
                    rateSpan.style.color = rate > 80 ? '#ef4444' : '#f59e0b';
                    
                    // Master 震动效果
                    master.style.transform = `translate(-50%, -50%) scale(${1 + Math.random()*0.2})`;
                };
            }, 100); // 频率
        }

        // Alluxio 模拟: 点分散到圆环
        function startAlluxioSimulation() {
            const container = document.getElementById('visual-alluxio');
            const tpsSpan = document.getElementById('tps-rate');
            const centerX = container.offsetWidth / 2;
            const centerY = container.offsetHeight / 2;
            const radius = 100;

            // 创建 Worker 节点环
            for(let i=0; i<6; i++) {
                const angle = (i / 6) * Math.PI * 2;
                const wx = centerX + Math.cos(angle) * radius - 25;
                const wy = centerY + Math.sin(angle) * radius - 25;
                
                const worker = document.createElement('div');
                worker.className = 'node worker-node';
                worker.innerText = "W"+(i+1);
                worker.style.left = wx + 'px';
                worker.style.top = wy + 'px';
                container.appendChild(worker);
            }

            let tps = 0;
            setInterval(() => {
                const dot = document.createElement('div');
                dot.className = 'client-dot';
                dot.style.top = '50%';
                dot.style.left = '50%';
                dot.style.background = '#10b981';
                container.appendChild(dot);

                // 随机去往某个 Worker
                const targetIdx = Math.floor(Math.random() * 6);
                const angle = (targetIdx / 6) * Math.PI * 2;
                const tx = Math.cos(angle) * radius;
                const ty = Math.sin(angle) * radius;

                const anim = dot.animate([
                    { opacity: 1, transform: 'translate(0, 0)' },
                    { transform: `translate(${tx}px, ${ty}px)`, opacity: 0 }
                ], {
                    duration: 800,
                    easing: 'linear'
                });

                anim.onfinish = () => {
                    dot.remove();
                    tps += 50;
                    tpsSpan.innerText = tps.toLocaleString();
                    
                    // Worker 闪烁
                    const workers = container.querySelectorAll('.worker-node');
                    workers[targetIdx].style.boxShadow = '0 0 20px #10b981';
                    setTimeout(() => workers[targetIdx].style.boxShadow = '0 0 15px currentColor', 200);
                };
            }, 50); // 更快
        }

        // 启动模拟
        setTimeout(startJFSSimulation, 1000);
        setTimeout(startAlluxioSimulation, 1000);


        /* ================== 3. 代码实验室逻辑 (Code Lab) ================== */
        const codeJFS = `
<span class="com"># --- JFS (Old Way) ---</span>
<span class="com"># 痛点: 需 root 权限, 内核态切换开销大</span>
<span class="kwd">import</span> os

<span class="com"># 1. 挂载 (阻塞操作)</span>
os.system(<span class="str">"mount -t juicefs /dev/vdb /mnt/jfs"</span>)

<span class="com"># 2. 读取文件 (经过 FUSE)</span>
<span class="kwd">with</span> open(<span class="str">"/mnt/jfs/data.mcap"</span>, <span class="str">"rb"</span>) <span class="kwd">as</span> f:
    f.seek(offset)
    data = f.read(1024)
`;

        const codeAlluxio = `
<span class="com"># --- Alluxio SDK (New Way) ---</span>
<span class="com"># 优势: 纯用户态, 零拷贝, 哈希直连</span>
<span class="kwd">from</span> alluxio <span class="kwd">import</span> Client

<span class="com"># 1. 初始化客户端 (轻量级)</span>
client = Client(<span class="str">"alluxio-cluster"</span>)

<span class="com"># 2. 直连 Worker 读取 (Hit Cluster Cache)</span>
<span class="kwd">with</span> client.open(<span class="str">"s3://data.mcap"</span>) <span class="kwd">as</span> f:
    data = f.read_range(offset, 1024)
`;

        let currentMode = 'jfs';
        const editor = document.getElementById('code-content');
        
        function switchTab(mode) {
            currentMode = mode;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-' + mode).classList.add('active');
            editor.innerHTML = mode === 'jfs' ? codeJFS : codeAlluxio;
            // 重置监控
            resetMonitor();
        }

        function resetMonitor() {
            document.getElementById('bar-latency').style.width = '0%';
            document.getElementById('bar-cpu').style.width = '0%';
            document.getElementById('latency-val').innerText = '0ms';
            document.getElementById('cpu-val').innerText = '0%';
            document.getElementById('console-log').innerHTML = '> Ready...';
        }

        function runCode() {
            const btn = document.getElementById('btn-run-code');
            const consoleLog = document.getElementById('console-log');
            btn.disabled = true;
            consoleLog.innerHTML = '> Compiling & Running...<br>';

            const isJFS = currentMode === 'jfs';
            
            // 模拟进度条动画
            setTimeout(() => {
                if (isJFS) {
                    // JFS 慢速
                    document.getElementById('bar-latency').style.width = '90%';
                    document.getElementById('bar-latency').style.background = '#ef4444'; // Red
                    document.getElementById('latency-val').innerText = '1500ms (High)';
                    
                    document.getElementById('bar-cpu').style.width = '80%';
                    document.getElementById('bar-cpu').style.background = '#ef4444';
                    document.getElementById('cpu-val').innerText = '80% (Context Switch)';
                    
                    consoleLog.innerHTML += '<span style="color:#ef4444">[WARN] FUSE bottleneck detected.</span><br>';
                    consoleLog.innerHTML += '> Execution Time: 2.4s';
                } else {
                    // Alluxio 极速
                    document.getElementById('bar-latency').style.width = '10%';
                    document.getElementById('bar-latency').style.background = '#10b981'; // Green
                    document.getElementById('latency-val').innerText = '20ms (Low)';
                    
                    document.getElementById('bar-cpu').style.width = '5%';
                    document.getElementById('bar-cpu').style.background = '#10b981';
                    document.getElementById('cpu-val').innerText = '5% (User Mode)';
                    
                    consoleLog.innerHTML += '<span style="color:#10b981">[INFO] Cache HIT on Worker-04.</span><br>';
                    consoleLog.innerHTML += '> Execution Time: 0.1s';
                }
                btn.disabled = false;
            }, isJFS ? 2000 : 500); // JFS 模拟慢，Alluxio 模拟快
        }

        // 初始化
        switchTab('jfs');

    </script>
</body>
</html>
