<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>300PB è‡ªåŠ¨é©¾é©¶æŒ–æ˜ï¼šå·¨äººå›¾ä¹¦é¦†çš„è¿›åŒ–å²</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-dark: #121212;
            --comic-white: #ffffff;
            --primary: #3b82f6; /* ç§‘æŠ€è“ */
            --accent: #f59e0b;  /* æ¼«ç”»é»„ */
            --danger: #ef4444;  /* è­¦å‘Šçº¢ */
            --success: #10b981; /* æˆåŠŸç»¿ */
            --border: 3px solid #000;
            --shadow: 6px 6px 0px rgba(0,0,0,0.8);
        }

        body {
            margin: 0;
            font-family: 'Noto Sans SC', sans-serif;
            background-color: var(--bg-dark);
            color: #333;
            overflow-x: hidden;
        }

        /* --- åŠ¨æ€èƒŒæ™¯ --- */
        #canvas-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; opacity: 0.15; pointer-events: none;
        }

        /* --- UI ç»„ä»¶ --- */
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .btn {
            border: var(--border); background: var(--accent); color: #000;
            padding: 10px 20px; font-family: 'Bangers'; font-size: 1.2rem; cursor: pointer;
            box-shadow: var(--shadow); transition: transform 0.1s; text-transform: uppercase;
        }
        .btn:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0 #000; }
        .btn.active { background: var(--primary); color: #fff; }

        /* --- æ¼«ç”»åˆ†é•œå®¹å™¨ --- */
        .section { padding: 60px 20px; display: flex; justify-content: center; }
        
        .comic-panel {
            background: var(--comic-white);
            border: var(--border);
            box-shadow: 10px 10px 0px rgba(255,255,255,0.1);
            max-width: 1100px; width: 100%;
            display: grid; grid-template-columns: 1fr 1fr;
            position: relative; overflow: hidden;
        }

        .speed-lines {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(0,0,0,0.02) 10px, rgba(0,0,0,0.02) 20px);
            z-index: 0; pointer-events: none;
        }

        .content-col { padding: 40px; position: relative; z-index: 1; display: flex; flex-direction: column; justify-content: center; }
        .visual-col { 
            background: #f1f5f9; border-left: var(--border); position: relative; 
            display: flex; align-items: center; justify-content: center; overflow: hidden; flex-direction: column;
        }

        /* æ°”æ³¡ä¸æ ‡é¢˜ */
        .speech-bubble {
            background: #fff; border: 2px solid #000; border-radius: 15px; padding: 15px;
            margin-bottom: 20px; position: relative; box-shadow: 4px 4px 0 rgba(0,0,0,0.1); font-weight: bold;
        }
        .speech-bubble::after {
            content: ''; position: absolute; bottom: -10px; left: 20px;
            border-width: 10px 10px 0; border-style: solid; border-color: #000 transparent;
        }
        
        .comic-title { font-family: 'Bangers'; font-size: 2.5rem; margin-bottom: 1rem; text-transform: uppercase; line-height: 1; }
        .text-danger { color: var(--danger); }
        .text-success { color: var(--success); }
        .text-accent { color: var(--accent); }

        /* --- è§†è§‰å…ƒç´ ï¼šæ¶æ„åŠ¨ç”» --- */
        .arch-node {
            position: absolute; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 0.8rem; color: white; box-shadow: 0 0 10px rgba(0,0,0,0.3); z-index: 2;
        }
        .node-master { width: 80px; height: 80px; background: var(--danger); top: 50%; left: 50%; transform: translate(-50%,-50%); }
        .node-worker { width: 50px; height: 50px; background: var(--success); transition: all 0.3s; }
        .data-dot { position: absolute; width: 8px; height: 8px; border-radius: 50%; pointer-events: none; z-index: 1; }

        /* --- è§†è§‰å…ƒç´ ï¼šä»ªè¡¨ç›˜ --- */
        .gauge-wrap { width: 160px; text-align: center; margin: 10px; }
        .gauge-body {
            width: 160px; height: 80px; background: #ddd; border-radius: 80px 80px 0 0; position: relative;
            overflow: hidden; border: 2px solid #000;
        }
        .gauge-gradient {
            width: 100%; height: 100%; position: absolute; top: 0; left: 0;
            background: conic-gradient(from 180deg, #10b981 0deg, #f59e0b 100deg, #ef4444 180deg);
        }
        .gauge-needle {
            width: 4px; height: 70px; background: #000; position: absolute; bottom: 0; left: 50%;
            transform-origin: bottom center; transform: rotate(-90deg); transition: transform 0.2s cubic-bezier(0.1, 1.5, 0.2, 1);
        }
        .gauge-val { font-family: 'Bangers'; font-size: 1.5rem; margin-top: 5px; }

        /* --- è§†è§‰å…ƒç´ ï¼šIDE --- */
        .ide-box { background: #1e1e1e; width: 90%; border-radius: 10px; overflow: hidden; border: 2px solid #000; color: #fff; }
        .ide-head { background: #333; padding: 10px; display: flex; gap: 10px; }
        .ide-tab { padding: 5px 15px; font-size: 0.8rem; cursor: pointer; color: #aaa; }
        .ide-tab.active { background: var(--primary); color: #fff; border-radius: 4px; }
        .ide-code { padding: 15px; font-family: 'Consolas', monospace; font-size: 0.9rem; min-height: 150px; color: #d4d4d4; }
        .c-kw { color: #569cd6; } .c-str { color: #ce9178; } .c-com { color: #6a9955; }
        
        /* --- å¯¼èˆªæ  --- */
        .nav-bar {
            position: sticky; top: 20px; z-index: 100; display: flex; justify-content: center; gap: 15px; margin-bottom: -40px;
        }

        /* å“åº”å¼ */
        @media (max-width: 900px) {
            .comic-panel { grid-template-columns: 1fr; }
            .visual-col { height: 300px; border-left: none; border-top: var(--border); }
        }
    </style>
</head>
<body>

    <canvas id="canvas-bg"></canvas>

    <div class="nav-bar">
        <button class="btn active" onclick="setMode('story')" id="btn-story">ğŸ“– æ¼«ç”»æ•…äº‹æ¨¡å¼</button>
        <button class="btn" onclick="setMode('tech')" id="btn-tech">âš™ï¸ æå®¢æ¶æ„æ¨¡å¼</button>
    </div>

    <div style="height: 90vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; color: white;">
        <div style="font-family: 'Bangers'; font-size: 2rem; color: var(--accent);">EPISODE 1: THE DATA AVALANCHE</div>
        <h1 style="font-family: 'Bangers'; font-size: 4rem; margin: 10px 0; text-shadow: 4px 4px 0 #3b82f6;">å·¨äººå›¾ä¹¦é¦†çš„è¿›åŒ–å²</h1>
        <p style="font-size: 1.2rem; max-width: 600px; color: #ddd;">
            å½“ 300PB æ•°æ®é‡ä¸Š 10 ä¸‡å¹¶å‘ä»»åŠ¡ï¼Œ<br>ä»¥åŠä¸€ä½æ‚£æœ‰â€œæ‰‹æ»‘ç—‡â€çš„ 112 æ ¸å·¨äººç®¡ç†å‘˜ã€‚
        </p>
        <i class="fas fa-chevron-down fa-bounce" style="margin-top: 40px; font-size: 2rem;"></i>
    </div>

    <div class="section">
        <div class="comic-panel">
            <div class="speed-lines"></div>
            <div class="content-col">
                <h2 class="comic-title text-danger" id="t1-title">ğŸ”¥ å±æœºï¼šå›¾ä¹¦é¦†å¤§æ‹¥å µ</h2>
                
                <div id="t1-story" class="fade-in">
                    <div class="speech-bubble">
                        <i class="fas fa-quote-left"></i> 
                        æˆ‘æ˜¯æ—§ç®¡ç†å‘˜ JFSã€‚ä»¥å‰æ¯å¤©æ¥å‡ ç™¾äººè¿˜è¡Œï¼Œä»Šå¤©çªç„¶æ¥äº† <strong>10ä¸‡äºº</strong>ï¼ä»–ä»¬å…¨æŒ¤åœ¨é—¨å£é—®æˆ‘ï¼šâ€œã€Šæœºå™¨äººæ—¥è®°ã€‹åœ¨å“ªï¼Ÿâ€
                    </div>
                    <p><strong>ç°çŠ¶ï¼š</strong> æ‰€æœ‰äººéƒ½è¦ç»è¿‡æˆ‘è¿™ä¸ªâ€œæ€»ç®¡â€æŸ¥ç›®å½•ã€‚æˆ‘å—“å­å–Šå“‘äº†ï¼Œå¤§å…è¿˜æ˜¯å µæ­»äº†ã€‚</p>
                    <p><strong>åæœï¼š</strong> ä¸šåŠ¡å…¨çº¿ç˜«ç—ªï¼Œæœºå™¨äººéƒ½åœ¨æ’é˜Ÿç­‰å¾…ã€‚</p>
                </div>

                <div id="t1-tech" class="hidden fade-in">
                    <div class="speech-bubble" style="border-color: var(--primary);">
                        Bottleneck: Centralized Metadata
                    </div>
                    <p><strong>JFS æ¶æ„ç—›ç‚¹ï¼š</strong> Master èŠ‚ç‚¹æ˜¯å•ç‚¹ç“¶é¢ˆã€‚åœ¨ 10 ä¸‡+ å¹¶å‘è¿æ¥ä¸‹ï¼ŒMaster çš„ QPS è¾¾åˆ°æé™ï¼ŒOpen/Lookup è¯·æ±‚å¤§é‡è¶…æ—¶ã€‚</p>
                    <p><strong>è¿ç»´å›°å¢ƒï¼š</strong> ä¸ºäº†ç¼“è§£å‹åŠ›ï¼Œè¢«è¿«ç‰©ç†æ‹†åˆ†å¤šä¸ªé›†ç¾¤ï¼Œå¯¼è‡´æ•°æ®å­¤å²›ã€‚</p>
                </div>
            </div>
            
            <div class="visual-col" id="viz-arch">
                <div style="position: absolute; bottom: 10px; font-weight: bold; background: white; padding: 5px 10px; border: 2px solid black;">
                    é˜»å¡ç‡: <span id="val-block" class="text-danger">0%</span>
                </div>
            </div>
        </div>
    </div>

    <div class="section">
        <div class="comic-panel" style="border-color: var(--primary);">
            <div class="speed-lines"></div>
            <div class="visual-col" style="background: #eef2ff; padding: 20px;">
                
                <div style="font-weight: bold; margin-bottom: 10px;">Monitor: File Handles</div>
                <div style="display: flex; flex-wrap: wrap; justify-content: center;">
                    <div class="gauge-wrap">
                        <div class="gauge-body"><div class="gauge-gradient"></div><div class="gauge-needle" id="ndl-jfs"></div></div>
                        <div class="gauge-val text-danger" id="val-jfs">850</div>
                        <small>JFS (High Risk)</small>
                    </div>
                    <div class="gauge-wrap">
                        <div class="gauge-body"><div class="gauge-gradient"></div><div class="gauge-needle" id="ndl-all"></div></div>
                        <div class="gauge-val text-success" id="val-all">150</div>
                        <small>Alluxio</small>
                    </div>
                </div>
                <button class="btn" style="margin: 20px 0; font-size: 1rem;" onclick="simStress()">ğŸ’¥ åŠ å‹æµ‹è¯•</button>

                <div style="width: 100%; border-top: 2px dashed #ccc; margin-top: 10px; padding-top: 20px;">
                    <div style="font-weight: bold; margin-bottom: 10px;">Cold Read Latency (çªå‡»æ£€æŸ¥)</div>
                    
                    <div style="display: flex; align-items: center; margin-bottom: 5px;">
                        <span style="width: 50px; font-size: 0.8rem;">JFS:</span>
                        <div style="flex: 1; height: 15px; background: #ddd; border: 1px solid #000;">
                            <div id="bar-jfs" style="width: 0%; height: 100%; background: var(--danger); transition: width 1.5s linear;"></div>
                        </div>
                        <span style="width: 50px; font-size: 0.8rem; text-align: right;" id="txt-jfs">Wait</span>
                    </div>

                    <div style="display: flex; align-items: center;">
                        <span style="width: 50px; font-size: 0.8rem;">Alluxio:</span>
                        <div style="flex: 1; height: 15px; background: #ddd; border: 1px solid #000;">
                            <div id="bar-all" style="width: 0%; height: 100%; background: var(--success); transition: width 0.3s cubic-bezier(0,1.5,.5,1);"></div>
                        </div>
                        <span style="width: 50px; font-size: 0.8rem; text-align: right;" id="txt-all">Wait</span>
                    </div>
                    <button class="btn" style="margin-top: 10px; font-size: 0.9rem; background: var(--primary); color: white;" onclick="simRace()">ğŸ å¼€å§‹å†·è¯»</button>
                </div>

            </div>

            <div class="content-col">
                <h2 class="comic-title text-accent" id="t2-title">ğŸ˜° å±æœºï¼šå·¨äººæ‰‹æ»‘ä¸çªå‡»æ£€æŸ¥</h2>
                
                <div id="t2-story" class="fade-in">
                    <p><strong>ä¸»è§’ï¼š</strong> ä¸€ä½åå«â€œå¤§åŠ›ç¥â€çš„ç®¡ç†å‘˜ï¼ˆ112æ ¸æœåŠ¡å™¨ï¼‰ã€‚</p>
                    <div class="speech-bubble">
                        <i class="fas fa-hand-paper"></i> 
                        <span class="text-danger">æ‰‹ä¸å¤Ÿç”¨äº†ï¼</span> è€æ¿è§„å®šæˆ‘æ‰‹é‡Œåªèƒ½æ‹¿ 1000 æœ¬ä¹¦ï¼ˆå¥æŸ„ï¼‰ã€‚JFS æ¨¡å¼ä¸‹ï¼Œæˆ‘ä¸ºäº†å¿«ï¼Œæ—¶åˆ»æç€ 800 å¤šæœ¬ã€‚ç¨å¾®å¤šæ¥ç‚¹ä»»åŠ¡ï¼Œæˆ‘å°±è¦æ‰‹æ»‘å´©ç›˜äº†ï¼
                    </div>
                    <div class="speech-bubble">
                        <i class="fas fa-stopwatch"></i> 
                        <span class="text-danger">çªå‡»æ£€æŸ¥å¤ªæ…¢ï¼</span> æ¯æ¬¡æ‰¾æ–°ä¹¦ï¼ˆå†·è¯»ï¼‰ï¼Œæˆ‘éƒ½å¾—å…ˆè·‘å»é—®æ€»ç®¡ã€‚è¿™è·‘è…¿æ—¶é—´å¤ªé•¿ï¼Œæœºå™¨äººéƒ½åœ¨ç­‰æˆ‘ã€‚
                    </div>
                    <p><strong>Alluxio æ•‘åœºï¼š</strong> è½»é‡çº§å¹³æ¿ï¼ˆSDKï¼‰ä¸ç”¨ä¸€ç›´æç€ä¹¦ï¼›å¿ƒçµæ„Ÿåº”ï¼ˆHashï¼‰è®©æˆ‘ä¸ç”¨é—®æ€»ç®¡ç›´æ¥å–ä¹¦ã€‚</p>
                </div>

                <div id="t2-tech" class="hidden fade-in">
                    <p><strong>Constraint 1: File Handles</strong></p>
                    <ul style="font-size: 0.9rem;">
                        <li><strong>Limit:</strong> `ulimit -n 1000` per Node.</li>
                        <li><strong>Risk:</strong> JFS è¿›ç¨‹å¸¸é©»å ç”¨ ~850 å¥æŸ„ï¼Œæ¥è¿‘å´©æºƒé˜ˆå€¼ã€‚</li>
                        <li><strong>Solution:</strong> Alluxio SDK æ—  FUSE ä¾èµ–ï¼Œè¿æ¥å¤ç”¨ï¼Œå¥æŸ„å ç”¨ < 200ã€‚</li>
                    </ul>
                    <p><strong>Constraint 2: Cold Read Latency</strong></p>
                    <ul style="font-size: 0.9rem;">
                        <li><strong>Challenge:</strong> æ— æ³•é¢„çƒ­ (No Job Load)ã€‚</li>
                        <li><strong>Optimization:</strong> DORA æ¶æ„å»é™¤äº† Master Lookup çš„ RTTã€‚å®¢æˆ·ç«¯é€šè¿‡ Hash ç›´æ¥å®šä½ Workerï¼Œé¦–å­—èŠ‚å»¶è¿Ÿé™ä½ 60%ã€‚</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="section">
        <div class="comic-panel">
            <div class="speed-lines"></div>
            <div class="content-col">
                <h2 class="comic-title text-success" id="t3-title">ğŸš€ è¿›åŒ–ï¼šæ™ºèƒ½å¹³æ¿æ—¶ä»£</h2>
                
                <div id="t3-story" class="fade-in">
                    <p>ä»¥å‰ï¼Œæ¯ä¸ªå­¦ç”Ÿè¦çœ‹ä¹¦éƒ½å¾—å…ˆå»åŠä¸€å¼ â€œå®ä½“å€Ÿä¹¦è¯â€ï¼ˆFUSEæŒ‚è½½ï¼‰ï¼Œæµç¨‹ç¹çï¼Œè¿˜å®¹æ˜“æŠŠç³»ç»ŸææŒ‚ã€‚</p>
                    <p>ç°åœ¨ï¼ŒAlluxio ç»™æ¯äººå‘äº†ä¸€ä¸ª<strong>â€œPython æ™ºèƒ½å¹³æ¿â€</strong> (SDK)ã€‚</p>
                    <ul style="list-style: none; padding: 0;">
                        <li>âœ… <strong>å…åŠè¯ï¼š</strong> ä¸ç”¨æŒ‚è½½ï¼Œç›´æ¥è¿è¡Œã€‚</li>
                        <li>âœ… <strong>æé€Ÿç¿»é¡µï¼š</strong> åŸç”Ÿæ”¯æŒ MCAP çš„è·³é¡µï¼ˆSeekï¼‰åŠŸèƒ½ã€‚</li>
                        <li>âœ… <strong>æ›´çœç”µï¼š</strong> ä¸æ¶ˆè€—ç³»ç»Ÿ CPU å»åšæ ¼å¼è½¬æ¢ã€‚</li>
                    </ul>
                </div>

                <div id="t3-tech" class="hidden fade-in">
                    <p><strong>FUSE vs SDK:</strong></p>
                    <ul style="font-size: 0.9rem;">
                        <li><strong>Legacy (FUSE):</strong> User Space -> Kernel (VFS/FUSE) -> User Space. ä¸Šä¸‹æ–‡åˆ‡æ¢æ¶ˆè€—å¤§é‡ CPUï¼Œå¯¼è‡´ 112 æ ¸ç®—åŠ›æµªè´¹ã€‚</li>
                        <li><strong>Next-Gen (SDK):</strong> çº¯ç”¨æˆ·æ€ç›´è¿ã€‚Zero-Copyã€‚</li>
                    </ul>
                    <p><strong>MCAP Optimization:</strong></p>
                    <p style="font-size: 0.9rem;">SDK åŸç”Ÿæ”¯æŒ HTTP Range Request è¯­ä¹‰ï¼Œå®Œç¾é€‚é… MCAP çš„ `Message Index` éšæœºè¯»å–æ¨¡å¼ã€‚</p>
                </div>
            </div>

            <div class="visual-col" style="background: #252526; display: block; padding: 0;">
                <div class="ide-box" style="margin: 20px auto; width: 90%;">
                    <div class="ide-head">
                        <div class="ide-tab active" onclick="switchCode('jfs')" id="tab-jfs">Legacy (JFS)</div>
                        <div class="ide-tab" onclick="switchCode('all')" id="tab-all">Modern (Alluxio)</div>
                    </div>
                    <div class="ide-code" id="code-area">
                        </div>
                    <div style="background: #111; padding: 10px; font-family: monospace; font-size: 0.8rem; color: #0f0; border-top: 1px solid #333; height: 60px;" id="console-log">
                        > Ready...
                    </div>
                </div>
                <div style="text-align: center; margin-bottom: 20px;">
                    <button class="btn" onclick="runCode()" style="font-size: 1rem;">â–¶ è¿è¡Œä»¿çœŸ</button>
                </div>
            </div>
        </div>
    </div>

    <div class="section" style="padding-top: 0;">
        <div style="background: var(--comic-white); border: var(--border); padding: 40px; border-radius: 20px; text-align: center; max-width: 800px; box-shadow: 10px 10px 0 rgba(0,0,0,0.5);">
            <h2 class="comic-title">ğŸ† æœ€ç»ˆæˆ˜æŠ¥</h2>
            <table style="width: 100%; border-collapse: collapse; margin-top: 20px; font-family: 'Noto Sans SC';">
                <tr style="background: #eee;">
                    <th style="padding: 10px; border: 1px solid #000;">æŒ‘æˆ˜</th>
                    <th style="padding: 10px; border: 1px solid #000;">JFS (æ—§æ—¶ä»£)</th>
                    <th style="padding: 10px; border: 1px solid #000; color: var(--primary);">Alluxio DORA (æ–°æ—¶ä»£)</th>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #000; font-weight: bold;">å®è§‚æ¶æ„</td>
                    <td style="padding: 10px; border: 1px solid #000; color: var(--danger);">ä¸­å¿ƒåŒ–æ€»ç®¡ (å µæ­»)</td>
                    <td style="padding: 10px; border: 1px solid #000; color: var(--success);">å»ä¸­å¿ƒåŒ– (çº¿æ€§æ‰©å±•)</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #000; font-weight: bold;">å¥æŸ„é£é™©</td>
                    <td style="padding: 10px; border: 1px solid #000; color: var(--danger);">é«˜ (æ¥è¿‘ 1000 å´©æºƒçº¿)</td>
                    <td style="padding: 10px; border: 1px solid #000; color: var(--success);">ä½ (è¿æ¥å¤ç”¨ < 200)</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #000; font-weight: bold;">å†·è¯»é€Ÿåº¦</td>
                    <td style="padding: 10px; border: 1px solid #000;">æ…¢ (éœ€æŸ¥è¯¢å…ƒæ•°æ®)</td>
                    <td style="padding: 10px; border: 1px solid #000; color: var(--success);">å¿« (Hash ç›´è¿æ—  RTT)</td>
                </tr>
            </table>
        </div>
    </div>

    <script>
        // --- 1. å…¨å±€çŠ¶æ€æ§åˆ¶ ---
        let mode = 'story';
        
        function setMode(m) {
            mode = m;
            // æŒ‰é’®æ ·å¼
            document.getElementById('btn-story').className = m === 'story' ? 'btn active' : 'btn';
            document.getElementById('btn-tech').className = m === 'tech' ? 'btn active' : 'btn';
            
            // æ–‡æœ¬åˆ‡æ¢
            const storyEls = document.querySelectorAll('[id$="-story"]');
            const techEls = document.querySelectorAll('[id$="-tech"]');
            
            storyEls.forEach(el => el.classList.toggle('hidden', m !== 'story'));
            techEls.forEach(el => el.classList.toggle('hidden', m !== 'tech'));

            // æ ‡é¢˜æ›´æ–° (ç¤ºä¾‹)
            document.getElementById('t1-title').innerText = m === 'story' ? "ğŸ”¥ å±æœºï¼šå›¾ä¹¦é¦†å¤§æ‹¥å µ" : "âš ï¸ Architecture Bottleneck";
            document.getElementById('t2-title').innerText = m === 'story' ? "ğŸ˜° å±æœºï¼šå·¨äººæ‰‹æ»‘ä¸çªå‡»æ£€æŸ¥" : "âš ï¸ Resource & Latency Constraints";
            document.getElementById('t3-title').innerText = m === 'story' ? "ğŸš€ è¿›åŒ–ï¼šæ™ºèƒ½å¹³æ¿æ—¶ä»£" : "ğŸ’» SDK Integration & Zero-Copy";
            
            // æ›´æ–°å¯è§†åŒ–åŒºåŸŸçš„æ ‡ç­¾
            resetVisuals();
        }

        function resetVisuals() {
            // é‡ç½®åŠ¨ç”»çŠ¶æ€
            document.getElementById('viz-arch').innerHTML = '<div style="position: absolute; bottom: 10px; font-weight: bold; background: white; padding: 5px 10px; border: 2px solid black;">Status: <span id="val-block" class="text-danger">Idle</span></div>';
            startArchAnim(); // é‡å¯æ¶æ„åŠ¨ç”»
        }

        // --- 2. æ¶æ„åŠ¨ç”» (JFS vs Alluxio) ---
        function startArchAnim() {
            const container = document.getElementById('viz-arch');
            // æ¸…ç©º
            const status = container.querySelector('div');
            
            // åˆ›å»ºä¸­å¿ƒèŠ‚ç‚¹ (Master) æˆ– åˆ†å¸ƒå¼èŠ‚ç‚¹ (Workers)
            // è¿™é‡Œä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬åšä¸€ä¸ªå¾ªç¯å±•ç¤ºï¼šå…ˆå±•ç¤º JFS æ‹¥å µï¼Œå†å±•ç¤º Alluxio æµç•…
            
            let isJfsPhase = true;
            let nodes = [];
            
            function setupPhase() {
                // æ¸…ç†æ—§ç‚¹
                const oldDots = container.querySelectorAll('.data-dot');
                oldDots.forEach(d => d.remove());
                const oldNodes = container.querySelectorAll('.arch-node');
                oldNodes.forEach(n => n.remove());

                if (isJfsPhase) {
                    // JFS: Center Master
                    const master = document.createElement('div');
                    master.className = 'arch-node node-master';
                    master.innerText = mode === 'story' ? "æ€»ç®¡" : "Master";
                    container.appendChild(master);
                    document.getElementById('val-block').innerText = "Congested (JFS)";
                    document.getElementById('val-block').className = "text-danger";
                } else {
                    // Alluxio: Ring
                    for(let i=0; i<5; i++) {
                        const w = document.createElement('div');
                        w.className = 'arch-node node-worker';
                        w.innerText = mode === 'story' ? "çª—å£" : "W" + i;
                        const angle = (i/5)*Math.PI*2;
                        w.style.left = (50 + 35*Math.cos(angle)) + '%';
                        w.style.top = (50 + 35*Math.sin(angle)) + '%';
                        w.style.transform = "translate(-50%, -50%)";
                        container.appendChild(w);
                    }
                    document.getElementById('val-block').innerText = "Smooth (Alluxio)";
                    document.getElementById('val-block').className = "text-success";
                }
            }

            setupPhase();

            // å‘å°„ç²’å­
            const interval = setInterval(() => {
                const dot = document.createElement('div');
                dot.className = 'data-dot';
                // éšæœºè¾¹ç¼˜
                dot.style.left = Math.random() < 0.5 ? '0%' : '100%';
                dot.style.top = Math.random() * 100 + '%';
                dot.style.background = isJfsPhase ? '#ef4444' : '#10b981';
                container.appendChild(dot);

                let tx, ty;
                if(isJfsPhase) {
                    tx = container.offsetWidth / 2;
                    ty = container.offsetHeight / 2;
                } else {
                    // éšæœºå»æŸä¸ª Worker
                    const angle = (Math.floor(Math.random()*5)/5)*Math.PI*2;
                    tx = container.offsetWidth/2 + (container.offsetWidth*0.35)*Math.cos(angle);
                    ty = container.offsetHeight/2 + (container.offsetHeight*0.35)*Math.sin(angle);
                }

                const anim = dot.animate([
                    { transform: 'translate(0,0)' },
                    { transform: `translate(${tx - dot.offsetLeft}px, ${ty - dot.offsetTop}px)` }
                ], { duration: isJfsPhase ? 1500 : 800, easing: 'linear' });

                anim.onfinish = () => {
                    dot.remove();
                    if(isJfsPhase) {
                        const m = container.querySelector('.node-master');
                        if(m) m.style.transform = `translate(-50%, -50%) scale(${1+Math.random()*0.2})`;
                    }
                };
            }, 100);

            // æ¯ 5 ç§’åˆ‡æ¢ä¸€æ¬¡åœºæ™¯
            setInterval(() => {
                isJfsPhase = !isJfsPhase;
                setupPhase();
            }, 5000);
        }

        // --- 3. ä»ªè¡¨ç›˜åŠ å‹ ---
        function simStress() {
            const ndlJ = document.getElementById('ndl-jfs');
            const txtJ = document.getElementById('val-jfs');
            const ndlA = document.getElementById('ndl-all');
            const txtA = document.getElementById('val-all');

            let step = 0;
            const timer = setInterval(() => {
                step++;
                // JFS: 800 -> 980 (Shake)
                let vJ = 800 + Math.random() * 190; 
                if(vJ > 1000) vJ = 1000;
                let degJ = ((vJ/1000)*180) - 90;
                ndlJ.style.transform = `rotate(${degJ}deg)`;
                txtJ.innerText = Math.floor(vJ);
                
                // Alluxio: Stable ~150
                let vA = 150 + Math.random() * 10;
                let degA = ((vA/1000)*180) - 90;
                ndlA.style.transform = `rotate(${degA}deg)`;
                txtA.innerText = Math.floor(vA);

                if(step > 30) clearInterval(timer);
            }, 50);
        }

        // --- 4. å†·è¯»ç«é€Ÿ ---
        function simRace() {
            const bJ = document.getElementById('bar-jfs');
            const bA = document.getElementById('bar-all');
            const tJ = document.getElementById('txt-jfs');
            const tA = document.getElementById('txt-all');

            // Reset
            bJ.style.width = '0%'; bJ.style.transition = 'none';
            bA.style.width = '0%'; bA.style.transition = 'none';
            tJ.innerText = 'Wait'; tA.innerText = 'Wait';

            setTimeout(() => {
                // Alluxio fast
                bA.style.transition = 'width 0.4s cubic-bezier(0,1.5,.5,1)';
                bA.style.width = '100%';
                setTimeout(() => tA.innerText = '40ms', 400);

                // JFS slow
                bJ.style.transition = 'width 1.5s linear';
                bJ.style.width = '100%';
                setTimeout(() => tJ.innerText = '150ms', 1500);
            }, 100);
        }

        // --- 5. ä»£ç æ¨¡æ‹Ÿ ---
        let codeMode = 'jfs';
        const cJfs = `<span class="c-com"># JFS (FUSE) - ä¼ªä»£ç </span>
<span class="c-kw">import</span> os
<span class="c-com"># 1. ä¾èµ– FUSE æŒ‚è½½ (é˜»å¡, è€—å¥æŸ„)</span>
os.system(<span class="c-str">"mount -t juicefs /dev/vdb /mnt"</span>)
<span class="c-kw">with</span> open(<span class="c-str">"/mnt/file.mcap"</span>, <span class="c-str">"rb"</span>) <span class="c-kw">as</span> f:
    f.seek(offset) <span class="c-com"># å†…æ ¸æ€åˆ‡æ¢</span>
    data = f.read(1024)`;

        const cAll = `<span class="c-com"># Alluxio (SDK) - ä¼ªä»£ç </span>
<span class="c-kw">from</span> alluxio <span class="c-kw">import</span> Client
<span class="c-com"># 1. è½»é‡ç›´è¿ (æ—  FUSE, çœå¥æŸ„)</span>
client = Client(<span class="c-str">"cluster-zs"</span>)
<span class="c-kw">with</span> client.open(<span class="c-str">"s3://file.mcap"</span>) <span class="c-kw">as</span> f:
    <span class="c-com"># Hash ç›´è¾¾ Worker</span>
    data = f.read_range(offset, 1024)`;

        function switchCode(m) {
            codeMode = m;
            document.getElementById('tab-jfs').className = m === 'jfs' ? 'ide-tab active' : 'ide-tab';
            document.getElementById('tab-all').className = m === 'all' ? 'ide-tab active' : 'ide-tab';
            document.getElementById('code-area').innerHTML = m === 'jfs' ? cJfs : cAll;
            document.getElementById('console-log').innerText = "> Ready...";
        }

        function runCode() {
            const log = document.getElementById('console-log');
            log.innerText = "> Compiling...";
            setTimeout(() => {
                if(codeMode === 'jfs') {
                    log.innerHTML = "<span style='color:red'>[WARN] High CPU Wait (Context Switch)</span><br>> Done in 1.2s";
                } else {
                    log.innerHTML = "<span style='color:#0f0'>[INFO] Zero-Copy Read. Worker Hit.</span><br>> Done in 0.05s";
                }
            }, 800);
        }

        // Init
        startArchAnim();
        switchCode('jfs');
        setMode('story');

        // Canvas BG
        const cvs = document.getElementById('canvas-bg');
        const ctx = cvs.getContext('2d');
        let w, h, parts = [];
        const resize = () => { w=cvs.width=window.innerWidth; h=cvs.height=window.innerHeight; };
        window.onresize = resize; resize();
        
        for(let i=0; i<60; i++) parts.push({x:Math.random()*w, y:Math.random()*h, vx:(Math.random()-.5), vy:(Math.random()-.5)});
        
        function animBg() {
            ctx.clearRect(0,0,w,h);
            ctx.fillStyle = '#3b82f6';
            parts.forEach(p => {
                p.x+=p.vx; p.y+=p.vy;
                if(p.x<0||p.x>w) p.vx*=-1; if(p.y<0||p.y>h) p.vy*=-1;
                ctx.beginPath(); ctx.arc(p.x, p.y, Math.random()*2, 0, Math.PI*2); ctx.fill();
            });
            requestAnimationFrame(animBg);
        }
        animBg();

    </script>
</body>
</html>
